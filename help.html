<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Help - AvicnKnov Ex</title>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f4f8;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #004080;
      color: white;
      padding: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header span {
      cursor: pointer;
      font-size: 20px;
    }
    h2 {
      color: #004080;
    }
    .options {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      padding: 20px;
      justify-content: center;
    }
    .option {
      background-color: white;
      border: 2px solid #004080;
      border-radius: 12px;
      padding: 15px 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
    }
    .option:hover {
      background-color: #004080;
      color: white;
    }
    .form-container {
      display: none;
      padding: 20px;
      background-color: #ffffff;
      border-radius: 10px;
      margin: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      position: relative;
    }
    .close-btn {
      position: absolute;
      top: 10px;
      right: 15px;
      font-weight: bold;
      cursor: pointer;
      color: red;
    }
    input, select, textarea {
      display: block;
      width: 100%;
      margin-bottom: 15px;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #004080;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }
    #requestViewer {
      display: none;
      padding: 20px;
    }
    .message-box {
      background-color: #e6f0ff;
      padding: 10px;
      margin: 10px 0;
      border-left: 4px solid #004080;
    }
    .back-btn {
      margin-top: 20px;
      background-color: #888;
    }
  </style>
</head>
<body>

<header>
  <span onclick="window.location.href='dashboard.html'">üîô Dashboard</span>
  <span onclick="openViewer()">üì© My Requests</span>
</header>

<div class="options">
  <div class="option" onclick="openForm('Account & Security')">Account & Security</div>
  <div class="option" onclick="openForm('Deposit and Withdrawal')">Deposit and Withdrawal</div>
  <div class="option" onclick="openForm('KYC Verification')">KYC Verification</div>
  <div class="option" onclick="openForm('P2P')">P2P</div>
  <div class="option" onclick="openForm('Trading')">Trading</div>
  <div class="option" onclick="openForm('Buy & Sell')">Buy & Sell</div>
  <div class="option" onclick="openForm('Other')">Other</div>
  <div class="option" onclick="openForm('Live Chat')">Live Chat</div>
</div>

<div id="formContainer" class="form-container">
  <span class="close-btn" onclick="closeForm()">‚ùå</span>
  <h2 id="formTitle">Support Request</h2>
  <select id="categorySelect">
    <option>Account & Security</option>
    <option>Deposit and Withdrawal</option>
    <option>KYC Verification</option>
    <option>P2P</option>
    <option>Trading</option>
    <option>Buy & Sell</option>
    <option>Other</option>
    <option>Live Chat</option>
  </select>
  <input type="text" id="fullname" placeholder="Full Name" />
  <input type="text" id="username" placeholder="Username" />
  <input type="text" id="uid" placeholder="UID" />
  <input type="email" id="email" placeholder="Contact Email" />
  <textarea id="message" maxlength="2000" placeholder="Describe your issue (max 2000 characters)"></textarea>
  <label>Send Screenshot/Video?</label>
  <select id="mediaOption" onchange="toggleUpload(this.value)">
    <option value="no">No</option>
    <option value="yes">Yes</option>
  </select>
  <div id="mediaUpload" style="display: none;">
    <input type="file" id="mediaFiles" multiple accept="image/*,video/*" />
  </div>
  <button onclick="submitForm()">Submit</button>
</div>

<div id="requestViewer">
  <h2>üìÑ Your Requests</h2>
  <div id="viewerContent"></div>
  <button class="back-btn" onclick="backToOptions()">üîô Back</button>
</div>

<!-- Additional Support Info -->
<div style="margin: 40px auto; max-width: 600px; background-color: #e6f7ff; border-left: 6px solid #004080; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); font-size: 16px;">
  <p><strong>Note:</strong> If you're unable to submit your issue or find a solution through the above options, or if you're facing trouble explaining your problem, you can directly reach out to us via email. We're constantly working to improve and assist you better.</p>
  <p>Please email us your issue at:</p>
  <div style="background-color: #ffffff; padding: 12px; border: 1px dashed #004080; font-weight: bold; color: #004080; text-align: center; border-radius: 8px; user-select: all;">
    help.avicnkvonteam@gmail.com
  </div>
</div>

<!-- Supabase Initialization -->
<script>
  const { createClient } = supabase;
  const supabaseClient = createClient(
    'https://hwrvqyipozrsxyjdpqag.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh3cnZxeWlwb3pyc3h5amRwcWFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA5MDc2NzksImV4cCI6MjA2NjQ4MzY3OX0.s43NjpUGDAJhs9qEmnwIXEY5aOh3gl6XqPdEveodFZM'
  );
</script>

<!-- Functionality -->
<script>
  function openForm(category) {
    document.getElementById('formContainer').style.display = 'block';
    document.getElementById('formTitle').innerText = category === 'Live Chat' ? 'Live Chat Request' : 'Support Request';
    document.getElementById('categorySelect').value = category;
  }

  function closeForm() {
    document.getElementById('formContainer').style.display = 'none';
  }

  function toggleUpload(value) {
    document.getElementById('mediaUpload').style.display = value === 'yes' ? 'block' : 'none';
  }

  async function submitForm() {
    const category = document.getElementById('categorySelect').value;
    const name = document.getElementById('fullname').value;
    const username = document.getElementById('username').value;
    const uid = document.getElementById('uid').value;
    const email = document.getElementById('email').value;
    const message = document.getElementById('message').value;
    const mediaFiles = document.getElementById('mediaFiles').files;

    let mediaUrls = [];

    if (mediaFiles.length > 0) {
      for (const file of mediaFiles) {
        const filePath = `${Date.now()}_${file.name}`;
        let { data, error } = await supabaseClient.storage.from('support-files').upload(filePath, file);
        if (!error) {
          const { publicUrl } = supabaseClient.storage.from('support-files').getPublicUrl(filePath).data;
          mediaUrls.push(publicUrl);
        }
      }
    }

    const { error } = await supabaseClient.from('support_requests').insert([{
      category,
      name,
      username,
      uid,
      email,
      message,
      media_urls: mediaUrls,
      reply: null
    }]);

    if (!error) {
      alert("Request submitted!");
      closeForm();
    } else {
      alert("Error: " + error.message);
    }
  }

  async function openViewer() {
    document.querySelector('.options').style.display = 'none';
    document.getElementById('formContainer').style.display = 'none';
    document.getElementById('requestViewer').style.display = 'block';

    const { data, error } = await supabaseClient.from('support_requests').select('*').order('id', { ascending: false });

    const viewer = document.getElementById('viewerContent');
    viewer.innerHTML = '';

    if (error) {
      viewer.innerHTML = 'Error loading requests.';
      return;
    }

    data.forEach(req => {
      const div = document.createElement('div');
      div.className = 'message-box';
      div.innerHTML = `
        <strong>Category:</strong> ${req.category}<br/>
        <strong>Message:</strong> ${req.message}<br/>
        <strong>Reply:</strong> ${req.reply || 'No reply yet'}<br/>
      `;
      viewer.appendChild(div);
    });
  }

  function backToOptions() {
    document.getElementById('requestViewer').style.display = 'none';
    document.querySelector('.options').style.display = 'flex';
  }
</script>

</body>
</html>