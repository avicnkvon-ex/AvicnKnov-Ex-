<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Crypto Wallet - Dashboard</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>

        * {

            margin: 0;

            padding: 0;

            box-sizing: border-box;

        }

        body {

            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;

            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

            min-height: 100vh;

            color: #333;

        }

        .container {

            max-width: 1200px;

            margin: 0 auto;

            padding: 20px;

        }

        /* Top Navigation */

        .nav-tabs {

            display: flex;

            background: rgba(255,255,255,0.95);

            border-radius: 15px;

            padding: 10px;

            margin-bottom: 20px;

            backdrop-filter: blur(10px);

            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);

        }

        .nav-tab {

            flex: 1;

            padding: 15px 25px;

            text-align: center;

            background: transparent;

            border: none;

            border-radius: 10px;

            cursor: pointer;

            font-size: 16px;

            font-weight: 600;

            transition: all 0.3s ease;

            color: #666;

        }

        .nav-tab.active {

            background: linear-gradient(135deg, #667eea, #764ba2);

            color: white;

            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);

        }

        .nav-tab:hover:not(.active) {

            background: rgba(102, 126, 234, 0.1);

            color: #667eea;

        }

        /* Profile Section */

        .profile-section {

            position: absolute;

            top: 20px;

            left: 20px;

            z-index: 1000;

        }

        .profile-icon {

            width: 50px;

            height: 50px;

            border-radius: 50%;

            background: linear-gradient(135deg, #667eea, #764ba2);

            display: flex;

            align-items: center;

            justify-content: center;

            cursor: pointer;

            color: white;

            font-size: 20px;

            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);

            transition: transform 0.3s ease;

        }

        .profile-icon:hover {

            transform: scale(1.1);

        }

        /* Balance Section */

        .balance-section {

            background: rgba(255,255,255,0.95);

            border-radius: 20px;

            padding: 30px;

            margin-bottom: 30px;

            text-align: center;

            backdrop-filter: blur(10px);

            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);

        }

        .balance-title {

            font-size: 18px;

            color: #666;

            margin-bottom: 10px;

        }

        .balance-amount {

            font-size: 36px;

            font-weight: bold;

            color: #333;

            margin-bottom: 10px;

        }

        .wallet-address-section {

            background: rgba(102, 126, 234, 0.1);

            border-radius: 10px;

            padding: 15px;

            margin-top: 15px;

        }

        .wallet-address {

            font-size: 14px;

            color: #666;

            word-break: break-all;

            margin-bottom: 10px;

        }

        .copy-btn {

            background: linear-gradient(135deg, #667eea, #764ba2);

            color: white;

            border: none;

            padding: 8px 16px;

            border-radius: 8px;

            cursor: pointer;

            font-size: 12px;

            transition: transform 0.2s ease;

        }

        .copy-btn:hover {

            transform: scale(1.05);

        }

        /* Main Operations Section - Horizontal Layout */

        .main-operations {

            background: rgba(255,255,255,0.95);

            border-radius: 20px;

            padding: 30px;

            margin-bottom: 30px;

            backdrop-filter: blur(10px);

            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);

        }

        .operations-tabs {

            display: flex;

            justify-content: center;

            gap: 20px;

            margin-bottom: 20px;

        }

        .operation-tab {

            padding: 15px 30px;

            background: linear-gradient(135deg, #667eea, #764ba2);

            color: white;

            border: none;

            border-radius: 12px;

            cursor: pointer;

            font-size: 16px;

            font-weight: 600;

            transition: all 0.3s ease;

            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);

        }

        .operation-tab:hover {

            transform: translateY(-2px);

            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);

        }

        .operation-content {

            display: none;

            animation: slideIn 0.3s ease;

        }

        .operation-content.active {

            display: block;

        }

        @keyframes slideIn {

            from {

                opacity: 0;

                transform: translateY(20px);

            }

            to {

                opacity: 1;

                transform: translateY(0);

            }

        }

        .close-operation-btn {

            float: right;

            background: #ef4444;

            color: white;

            border: none;

            border-radius: 50%;

            width: 30px;

            height: 30px;

            cursor: pointer;

            font-size: 16px;

            margin-bottom: 15px;

        }

        .operation-options {

            display: grid;

            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));

            gap: 15px;

        }

        .option-btn {

            padding: 20px;

            border: 2px solid #e0e0e0;

            border-radius: 12px;

            background: white;

            cursor: pointer;

            transition: all 0.3s ease;

            text-align: center;

            box-shadow: 0 2px 10px rgba(0,0,0,0.1);

        }

        .option-btn:hover {

            border-color: #667eea;

            background: rgba(102, 126, 234, 0.05);

            transform: translateY(-3px);

            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.2);

        }

        .option-btn i {

            font-size: 24px;

            color: #667eea;

            margin-bottom: 10px;

            display: block;

        }

        .option-btn .title {

            font-size: 16px;

            font-weight: 600;

            color: #333;

        }

        /* Trading Section */

        .trading-section {

            background: rgba(255,255,255,0.95);

            border-radius: 15px;

            padding: 25px;

            backdrop-filter: blur(10px);

            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);

        }

        .section-title {

            font-size: 20px;

            font-weight: bold;

            margin-bottom: 20px;

            color: #333;

            text-align: center;

        }

        .trading-tabs {

            display: flex;

            margin-bottom: 20px;

            background: rgba(102, 126, 234, 0.1);

            border-radius: 10px;

            padding: 5px;

        }

        .trading-tab {

            flex: 1;

            padding: 12px;

            text-align: center;

            border: none;

            background: transparent;

            border-radius: 8px;

            cursor: pointer;

            font-size: 14px;

            font-weight: 600;

            transition: all 0.3s ease;

        }

        .trading-tab.active {

            background: linear-gradient(135deg, #667eea, #764ba2);

            color: white;

        }

        .token-list {

            max-height: 400px;

            overflow-y: auto;

        }

        .token-item {

            display: flex;

            align-items: center;

            justify-content: space-between;

            padding: 15px;

            border-bottom: 1px solid #e0e0e0;

            transition: background 0.2s ease;

        }

        .token-item:hover {

            background: rgba(102, 126, 234, 0.05);

        }

        .token-info {

            flex: 1;

        }

        .token-symbol {

            font-weight: bold;

            font-size: 16px;

            color: #333;

        }

        .token-name {

            font-size: 12px;

            color: #666;

        }

        .token-price {

            font-weight: bold;

            color: #667eea;

            margin: 0 20px;

            cursor: pointer;

        }

        .token-actions {

            display: flex;

            gap: 10px;

        }

        .buy-btn, .sell-btn {

            padding: 8px 16px;

            border: none;

            border-radius: 6px;

            cursor: pointer;

            font-size: 12px;

            font-weight: 600;

            transition: transform 0.2s ease;

        }

        .buy-btn {

            background: #22c55e;

            color: white;

        }

        .sell-btn {

            background: #ef4444;

            color: white;

        }

        .buy-btn:hover, .sell-btn:hover {

            transform: scale(1.05);

        }

        /* Modal Styles */

        .modal {

            display: none;

            position: fixed;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            background: rgba(0,0,0,0.7);

            z-index: 2000;

            backdrop-filter: blur(5px);

        }

        .modal.show {

            display: flex;

            align-items: center;

            justify-content: center;

        }

        .modal-content {

            background: white;

            border-radius: 20px;

            padding: 30px;

            max-width: 500px;

            width: 90%;

            max-height: 80vh;

            overflow-y: auto;

            position: relative;

            animation: modalSlideIn 0.3s ease;

        }

        @keyframes modalSlideIn {

            from {

                transform: translateY(-50px);

                opacity: 0;

            }

            to {

                transform: translateY(0);

                opacity: 1;

            }

        }

        .modal-header {

            display: flex;

            justify-content: space-between;

            align-items: center;

            margin-bottom: 25px;

            padding-bottom: 15px;

            border-bottom: 2px solid #e0e0e0;

        }

        .modal-title {

            font-size: 24px;

            font-weight: bold;

            color: #333;

        }

        .close-btn {

            background: none;

            border: none;

            font-size: 28px;

            color: #999;

            cursor: pointer;

            line-height: 1;

        }

        .form-group {

            margin-bottom: 20px;

        }

        .form-label {

            display: block;

            font-weight: 600;

            margin-bottom: 8px;

            color: #333;

        }

        .form-input {

            width: 100%;

            padding: 12px;

            border: 2px solid #e0e0e0;

            border-radius: 8px;

            font-size: 16px;

            transition: border-color 0.3s ease;

        }

        .form-input:focus {

            outline: none;

            border-color: #667eea;

        }

        .form-select {

            width: 100%;

            padding: 12px;

            border: 2px solid #e0e0e0;

            border-radius: 8px;

            font-size: 16px;

            background: white;

        }

        .submit-btn {

            width: 100%;

            padding: 15px;

            background: linear-gradient(135deg, #667eea, #764ba2);

            color: white;

            border: none;

            border-radius: 10px;

            font-size: 16px;

            font-weight: 600;

            cursor: pointer;

            transition: transform 0.2s ease;

        }

        .submit-btn:hover {

            transform: translateY(-2px);

        }

        /* Transaction List */

        .transaction-item {

            background: #f8f9fa;

            border-radius: 10px;

            padding: 15px;

            margin-bottom: 10px;

            border-left: 4px solid #667eea;

        }

        .transaction-header {

            display: flex;

            justify-content: space-between;

            align-items: center;

            margin-bottom: 8px;

        }

        .transaction-type {

            font-weight: bold;

            color: #333;

        }

        .transaction-status {

            padding: 4px 8px;

            border-radius: 4px;

            font-size: 12px;

            font-weight: 600;

        }

        .status-pending {

            background: #fef3c7;

            color: #d97706;

        }

        .status-processing {

            background: #dbeafe;

            color: #2563eb;

        }

        .status-success {

            background: #d1fae5;

            color: #059669;

        }

        .status-reject {

            background: #fee2e2;

            color: #dc2626;

        }

        .transaction-details {

            font-size: 14px;

            color: #666;

            line-height: 1.5;

        }

        .holding-item {

            background: #f0f9ff;

            border-radius: 10px;

            padding: 15px;

            margin-bottom: 10px;

            border-left: 4px solid #22c55e;

        }

        .holding-header {

            display: flex;

            justify-content: space-between;

            align-items: center;

            margin-bottom: 8px;

        }

        .holding-symbol {

            font-weight: bold;

            font-size: 16px;

            color: #333;

        }

        .holding-value {

            font-weight: bold;

            color: #22c55e;

        }

        .holding-details {

            font-size: 14px;

            color: #666;

            margin-bottom: 10px;

        }

        .holding-actions {

            display: flex;

            gap: 10px;

        }

        .holding-btn {

            padding: 6px 12px;

            border: none;

            border-radius: 4px;

            cursor: pointer;

            font-size: 12px;

            font-weight: 600;

        }

        .holding-buy-btn {

            background: #22c55e;

            color: white;

        }

        .holding-sell-btn {

            background: #ef4444;

            color: white;

        }

        /* Help Button */

        .help-btn {

            position: fixed;

            bottom: 20px;

            right: 20px;

            width: 60px;

            height: 60px;

            border-radius: 50%;

            background: linear-gradient(135deg, #667eea, #764ba2);

            color: white;

            border: none;

            font-size: 24px;

            cursor: pointer;

            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);

            transition: transform 0.3s ease;

            z-index: 1000;

        }

        .help-btn:hover {

            transform: scale(1.1);

        }

        /* Toast Notification */

        .toast {

            position: fixed;

            bottom: 100px;

            right: 20px;

            background: #333;

            color: white;

            padding: 15px 20px;

            border-radius: 10px;

            font-weight: 600;

            z-index: 3000;

            opacity: 0;

            transform: translateX(100px);

            transition: all 0.3s ease;

        }

        .toast.show {

            opacity: 1;

            transform: translateX(0);

        }

        .toast.success {

            background: #22c55e;

        }

        .toast.error {

            background: #ef4444;

        }

        /* Responsive Design */

        @media (max-width: 768px) {

            .container {

                padding: 10px;

            }

            

            .nav-tab {

                padding: 12px 15px;

                font-size: 14px;

            }

            

            .balance-amount {

                font-size: 28px;

            }

            

            .operations-tabs {

                flex-direction: column;

                gap: 10px;

            }

            

            .operation-tab {

                padding: 12px 20px;

                font-size: 14px;

            }

            

            .profile-section {

                position: relative;

                top: 0;

                left: 0;

                margin-bottom: 20px;

                text-align: center;

            }

        }

        .hidden {

            display: none !important;

        }

        /* Chart Styles */

        .chart-container {

            margin-top: 20px;

            text-align: center;

        }

        #priceChart {

            border: 1px solid #e0e0e0;

            border-radius: 10px;

            margin: 10px 0;

        }

    </style>

</head>

<body>

    <div class="container">

        <!-- Profile Section -->

        <div class="profile-section">

            <div class="profile-icon" onclick="openProfileModal()">

                <i class="fas fa-user"></i>

            </div>

        </div>

        <!-- Navigation Tabs -->

        <div class="nav-tabs">

            <button class="nav-tab" onclick="window.location.href='assets.html'">

                <i class="fas fa-coins"></i> Assets

            </button>

            <button class="nav-tab active">

                <i class="fas fa-wallet"></i> Wallet

            </button>

        </div>

        <!-- Balance Section -->

        <div class="balance-section">

            <div class="balance-title">Total Balance</div>

            <div class="balance-amount" id="totalBalance">₹0.00</div>

            <div class="wallet-address-section">

                <div style="font-size: 12px; color: #666; margin-bottom: 5px;">Wallet Address:</div>

                <div class="wallet-address" id="walletAddress">Loading...</div>

                <button class="copy-btn" onclick="copyWalletAddress()">

                    <i class="fas fa-copy"></i> Copy Address

                </button>

            </div>

        </div>

        <!-- Main Operations Section -->

        <div class="main-operations">

            <div class="operations-tabs">

                <button class="operation-tab" onclick="toggleOperation('deposit')">

                    <i class="fas fa-plus-circle"></i> Deposit

                </button>

                <button class="operation-tab" onclick="toggleOperation('withdrawal')">

                    <i class="fas fa-minus-circle"></i> Withdrawal

                </button>

                <button class="operation-tab" onclick="toggleOperation('transactions')">

                    <i class="fas fa-history"></i> Transactions

                </button>

            </div>

            <!-- Deposit Content -->

            <div class="operation-content" id="depositContent">

                <button class="close-operation-btn" onclick="closeOperation()">&times;</button>

                <div class="operation-options">

                    <div class="option-btn" onclick="openDepositModal('upi')">

                        <i class="fas fa-mobile-alt"></i>

                        <div class="title">Deposit UPI</div>

                    </div>

                    <div class="option-btn" onclick="openDepositModal('crypto')">

                        <i class="fab fa-bitcoin"></i>

                        <div class="title">Deposit Crypto</div>

                    </div>

                    <div class="option-btn" onclick="openDepositModal('wallet')">

                        <i class="fas fa-wallet"></i>

                        <div class="title">Deposit Wallet</div>

                    </div>

                </div>

            </div>

            <!-- Withdrawal Content -->

            <div class="operation-content" id="withdrawalContent">

                <button class="close-operation-btn" onclick="closeOperation()">&times;</button>

                <div class="operation-options">

                    <div class="option-btn" onclick="openWithdrawalModal('upi')">

                        <i class="fas fa-mobile-alt"></i>

                        <div class="title">Withdrawal UPI</div>

                    </div>

                    <div class="option-btn" onclick="openWithdrawalModal('crypto')">

                        <i class="fab fa-bitcoin"></i>

                        <div class="title">Withdrawal Crypto</div>

                    </div>

                    <div class="option-btn" onclick="openWithdrawalModal('wallet')">

                        <i class="fas fa-wallet"></i>

                        <div class="title">Withdrawal Wallet</div>

                    </div>

                </div>

            </div>

            <!-- Transactions Content -->

            <div class="operation-content" id="transactionsContent">

                <button class="close-operation-btn" onclick="closeOperation()">&times;</button>

                <div id="transactionsList">

                    <div style="text-align: center; color: #666; padding: 20px;">

                        Loading transactions...

                    </div>

                </div>

            </div>

        </div>

        <!-- Trading Section -->

        <div class="trading-section">

            <div class="section-title"><i class="fas fa-chart-line"></i> Trading</div>

            <div class="trading-tabs">

                <button class="trading-tab active" onclick="switchTradingTab('all')">All</button>

                <button class="trading-tab" onclick="switchTradingTab('crypto')">Crypto</button>

                <button class="trading-tab" onclick="switchTradingTab('meme')">M&C</button>

                <button class="trading-tab" onclick="switchTradingTab('holding')">Holding</button>

            </div>

            <div class="token-list" id="tokenList">

                <!-- Tokens will be loaded here -->

            </div>

        </div>

    </div>

    <!-- Help Button -->

    <button class="help-btn" onclick="window.location.href='help.html'" title="Help & Support">

        <i class="fas fa-question"></i>

    </button>

    <!-- Profile Modal -->

    <div class="modal" id="profileModal">

        <div class="modal-content">

            <div class="modal-header">

                <h2 class="modal-title">Profile</h2>

                <button class="close-btn" onclick="closeModal('profileModal')">&times;</button>

            </div>

            <div class="form-group">

                <label class="form-label">UID</label>

                <input type="text" class="form-input" id="userUID" readonly>

            </div>

            <div class="form-group">

                <label class="form-label">Name</label>

                <input type="text" class="form-input" id="userName" placeholder="Enter your name">

            </div>

            <div class="form-group">

                <label class="form-label">Username</label>

                <input type="text" class="form-input" id="userUsername" placeholder="Enter username">

            </div>

            <button class="submit-btn" onclick="saveProfile()">Save Profile</button>

        </div>

    </div>

    <!-- Deposit Modal -->

    <div class="modal" id="depositModal">

        <div class="modal-content">

            <div class="modal-header">

                <h2 class="modal-title" id="depositModalTitle">Deposit</h2>

                <button class="close-btn" onclick="closeModal('depositModal')">&times;</button>

            </div>

            <div id="depositModalContent">

                <!-- Content will be loaded based on deposit type -->

            </div>

        </div>

    </div>

    <!-- Withdrawal Modal -->

    <div class="modal" id="withdrawalModal">

        <div class="modal-content">

            <div class="modal-header">

                <h2 class="modal-title" id="withdrawalModalTitle">Withdrawal</h2>

                <button class="close-btn" onclick="closeModal('withdrawalModal')">&times;</button>

            </div>

            <div id="withdrawalModalContent">

                <!-- Content will be loaded based on withdrawal type -->

            </div>

        </div>

    </div>

    <!-- Trading Modal -->

    <div class="modal" id="tradingModal">

        <div class="modal-content">

            <div class="modal-header">

                <h2 class="modal-title" id="tradingModalTitle">Trade</h2>

                <button class="close-btn" onclick="closeModal('tradingModal')">&times;</button>

            </div>

            <div id="tradingModalContent">

                <!-- Trading form will be loaded here -->

            </div>

        </div>

    </div>

    <!-- Chart Modal -->

    <div class="modal" id="chartModal">

        <div class="modal-content">

            <div class="modal-header">

                <h2 class="modal-title" id="chartModalTitle">Price Chart</h2>

                <button class="close-btn" onclick="closeModal('chartModal')">&times;</button>

            </div>

            <div class="chart-container">

                <canvas id="priceChart" width="400" height="200"></canvas>

                <div style="margin-top: 10px; color: #666; font-size: 14px;">Last 30 Days Price History</div>

            </div>

        </div>

    </div>

    <!-- Toast Notification -->

    <div class="toast" id="toast"></div>

    <!-- Supabase CDN -->

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>

        // Supabase Configuration

        const SUPABASE_URL = 'https://hwrvqyipozrsxyjdpqag.supabase.co';

        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh3cnZxeWlwb3pyc3h5amRwcWFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA5MDc2NzksImV4cCI6MjA2NjQ4MzY3OX0.s43NjpUGDAJhs9qEmnwIXEY5aOh3gl6XqPdEveodFZM';

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // Global Variables

        let currentUser = null;

        let currentTradingTab = 'all';

        let livePrices = {};

        let userProfile = {};

        let userWalletAddress = '';

        let userHoldings = {};

        let existingUIDs = new Set(); // Track used UIDs

        // Token Lists

        const cryptoTokens = [

            ['BTC', 'Bitcoin', 'bitcoin'],

            ['ETH', 'Ethereum', 'ethereum'],

            ['BNB', 'BNB', 'binancecoin'],

            ['SOL', 'Solana', 'solana'],

            ['XRP', 'XRP', 'ripple'],

            ['ADA', 'Cardano', 'cardano'],

            ['MATIC', 'Polygon', 'matic-network'],

            ['DOT', 'Polkadot', 'polkadot'],

            ['LTC', 'Litecoin', 'litecoin'],

            ['TRX', 'TRON', 'tron'],

            ['AVAX', 'Avalanche', 'avalanche-2'],

            ['ATOM', 'Cosmos', 'cosmos'],

            ['XLM', 'Stellar', 'stellar'],

            ['LINK', 'Chainlink', 'chainlink'],

            ['UNI', 'Uniswap', 'uniswap']

        ];

        const memeTokens = [

            ['DOGE', 'Dogecoin', 'dogecoin'],

            ['SHIB', 'Shiba Inu', 'shiba-inu'],

            ['PEPE', 'Pepe', 'pepe'],

            ['FLOKI', 'Floki', 'floki'],

            ['BONK', 'Bonk', 'bonk'],

            ['WIF', 'dogwifhat', 'dogwifhat'],

            ['BRETT', 'Brett (Based)', 'based-brett'],

            ['POPCAT', 'Popcat (SOL)', 'popcat'],

            ['NEIRO', 'Neiro', 'neiro'],

            ['MOG', 'Mog Coin', 'mog-coin'],

            ['TURBO', 'Turbo', 'turbo'],

            ['MEME', 'Memecoin', 'memecoin'],

            ['BABYDOGE', 'Baby Doge Coin', 'baby-doge-coin'],

            ['WOJAK', 'Wojak', 'wojak'],

            ['LADYS', 'Milady Meme Coin', 'milady-meme-coin']

        ];

        const allTokens = [...cryptoTokens, ...memeTokens];

        // ID Generators - Fixed to avoid sequential patterns

        function generateUID() {

            let uid;

            do {

                // Generate random 8-digit numeric UID (avoiding sequential patterns)

                const digits = [];

                for (let i = 0; i < 8; i++) {

                    digits.push(Math.floor(Math.random() * 10));

                }

                

                // Ensure not sequential like 12345678

                let isSequential = true;

                for (let i = 1; i < digits.length; i++) {

                    if (digits[i] !== digits[i-1] + 1) {

                        isSequential = false;

                        break;

                    }

                }

                

                // Ensure not all same digits like 11111111

                let allSame = digits.every(d => d === digits[0]);

                

                if (!isSequential && !allSame) {

                    uid = digits.join('');

                }

            } while (!uid || existingUIDs.has(uid));

            

            existingUIDs.add(uid);

            return uid;

        }

        function generateWalletAddress() {

            const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';

            return Array.from({length: 26}, () => 

                chars.charAt(Math.floor(Math.random() * chars.length))

            ).join('');

        }

        function generateOrderID() {

            return Math.floor(100000 + Math.random() * 900000).toString(); // 6-digit order ID

        }

        // Initialize App

        async function initApp() {

            await loadExistingUIDs();

            await loadUser();

            await loadUserProfile();

            await loadWalletAddress();

            await loadBalance();

            await loadLivePrices();

            await loadHoldings();

            loadTokenList();

            

            // Start price refresh interval

            setInterval(loadLivePrices, 10000); // Refresh every 10 seconds

        }

        // Load existing UIDs to prevent duplicates

        async function loadExistingUIDs() {

            try {

                const { data, error } = await supabase

                    .from('ak-profile-user')

                    .select('uid');

                

                if (!error && data) {

                    data.forEach(item => existingUIDs.add(item.uid));

                }

            } catch (error) {

                console.log('Could not load existing UIDs:', error);

            }

        }

        // User Management

        async function loadUser() {

            try {

                const { data: { user }, error } = await supabase.auth.getUser();

                if (error) throw error;

                currentUser = user;

                

                if (!user) {

                    currentUser = { id: 'demo-user-' + Date.now() };

                }

            } catch (error) {

                console.error('Error loading user:', error);

                currentUser = { id: 'demo-user-' + Date.now() };

            }

        }

        // Profile Management

        async function loadUserProfile() {

            if (!currentUser) return;

            try {

                const { data, error } = await supabase

                    .from('ak-profile-user')

                    .select('*')

                    .eq('user_id', currentUser.id)

                    .single();

                if (error && error.code !== 'PGRST116') throw error;

                if (data) {

                    userProfile = data;

                } else {

                    // Create new profile with temporary data

                    const newProfile = {

                        user_id: currentUser.id,

                        uid: generateUID(),

                        name: 'राज कुमार', // Temporary name

                        username: 'raj_user2024' // Temporary username

                    };

                    const { data: insertedData, error: insertError } = await supabase

                        .from('ak-profile-user')

                        .insert([newProfile])

                        .select()

                        .single();

                    if (insertError) throw insertError;

                    userProfile = insertedData;

                }

                // Update UI

                document.getElementById('userUID').value = userProfile.uid;

                document.getElementById('userName').value = userProfile.name;

                document.getElementById('userUsername').value = userProfile.username;

            } catch (error) {

                console.error('Error loading profile:', error);

                userProfile = {

                    uid: generateUID(),

                    name: 'राज कुमार',

                    username: 'raj_user2024'

                };

            }

        }

        // Wallet Address Management

        async function loadWalletAddress() {

            if (!currentUser) return;

            try {

                const { data, error } = await supabase

                    .from('ak-wallet-address')

                    .select('*')

                    .eq('user_id', currentUser.id)

                    .single();

                if (error && error.code !== 'PGRST116') throw error;

                if (data) {

                    userWalletAddress = data.wallet_address;

                } else {

                    const newAddress = generateWalletAddress();

                    const newAddressRecord = {

                        user_id: currentUser.id,

                        uid: userProfile.uid,

                        name: userProfile.name,

                        username: userProfile.username,

                        wallet_address: newAddress

                    };

                    const { data: insertedData, error: insertError } = await supabase

                        .from('ak-wallet-address')

                        .insert([newAddressRecord])

                        .select()

                        .single();

                    if (insertError) throw insertError;

                    userWalletAddress = insertedData.wallet_address;

                }

                document.getElementById('walletAddress').textContent = userWalletAddress;

            } catch (error) {

                console.error('Error loading wallet address:', error);

                userWalletAddress = generateWalletAddress();

                document.getElementById('walletAddress').textContent = userWalletAddress;

            }

        }

        // Balance Management

        async function loadBalance() {

            if (!currentUser) return;

            try {

                const { data, error } = await supabase

                    .from('ak-wallet-user')

                    .select('*')

                    .eq('user_id', currentUser.id)

                    .single();

                if (error && error.code !== 'PGRST116') throw error;

                let balance = 0;

                if (data) {

                    balance = parseFloat(data.balance || 0);

                } else {

                    const newWalletRecord = {

                        user_id: currentUser.id,

                        username: userProfile.username,

                        balance: 0

                    };

                    const { error: insertError } = await supabase

                        .from('ak-wallet-user')

                        .insert([newWalletRecord]);

                    if (insertError) throw insertError;

                }

                updateBalanceUI(balance);

            } catch (error) {

                console.error('Error loading balance:', error);

                updateBalanceUI(0);

            }

        }

        function updateBalanceUI(balance) {

            document.getElementById('totalBalance').textContent = '₹' + balance.toLocaleString('en-IN', {

                minimumFractionDigits: 2,

                maximumFractionDigits: 2

            });

        }

        // Live Prices

        async function loadLivePrices() {

            try {

                const coinIds = allTokens.map(token => token[2]).join(',');

                const response = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${coinIds}&vs_currencies=inr`);

                const data = await response.json();

                allTokens.forEach(([symbol, name, id]) => {

                    if (data[id] && data[id].inr) {

                        livePrices[symbol] = data[id].inr;

                    }

                });

                updateTokenPrices();

            } catch (error) {

                console.error('Error loading prices:', error);

                showToast('Error loading prices', false);

            }

        }

        function updateTokenPrices() {

            const tokenItems = document.querySelectorAll('.token-item');

            tokenItems.forEach(item => {

                const symbol = item.dataset.symbol;

                const priceElement = item.querySelector('.token-price');

                if (priceElement && livePrices[symbol]) {

                    priceElement.textContent = '₹' + livePrices[symbol].toLocaleString('en-IN');

                }

            });

        }

        // Holdings Management

        async function loadHoldings() {

            if (!currentUser) return;

            try {

                const { data, error } = await supabase

                    .from('ak-trade-history')

                    .select('*')

                    .eq('user_id', currentUser.id);

                if (error) throw error;

                // Calculate current holdings from trade history

                userHoldings = {};

                if (data) {

                    data.forEach(trade => {

                        const symbol = trade.symbol;

                        if (!userHoldings[symbol]) {

                            userHoldings[symbol] = { quantity: 0, total_cost: 0 };

                        }

                        if (trade.action === 'buy') {

                            userHoldings[symbol].quantity += parseFloat(trade.quantity);

                            userHoldings[symbol].total_cost += parseFloat(trade.amount);

                        } else if (trade.action === 'sell') {

                            userHoldings[symbol].quantity -= parseFloat(trade.quantity);

                            if (userHoldings[symbol].quantity <= 0) {

                                delete userHoldings[symbol];

                            }

                        }

                    });

                }

            } catch (error) {

                console.error('Error loading holdings:', error);

                userHoldings = {};

            }

        }

        // Trading Tab Management

        function switchTradingTab(tab) {

            currentTradingTab = tab;

            

            // Update active tab

            document.querySelectorAll('.trading-tab').forEach(t => t.classList.remove('active'));

            event.target.classList.add('active');

            

            loadTokenList();

        }

        function loadTokenList() {

            const tokenList = document.getElementById('tokenList');

            

            if (currentTradingTab === 'holding') {

                // Show holdings

                if (Object.keys(userHoldings).length === 0) {

                    tokenList.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">No holdings yet</div>';

                    return;

                }

                let holdingsHTML = '';

                for (const [symbol, holding] of Object.entries(userHoldings)) {

                    const currentPrice = livePrices[symbol] || 0;

                    const currentValue = holding.quantity * currentPrice;

                    const profitLoss = currentValue - holding.total_cost;

                    

                    holdingsHTML += `

                        <div class="holding-item">

                            <div class="holding-header">

                                <span class="holding-symbol">${symbol}</span>

                                <span class="holding-value">₹${currentValue.toLocaleString('en-IN')}</span>

                            </div>

                            <div class="holding-details">

                                Quantity: ${holding.quantity.toFixed(6)} | 

                                Avg Cost: ₹${(holding.total_cost / holding.quantity).toFixed(2)} | 

                                Current Price: ₹${currentPrice.toLocaleString('en-IN')} | 

                                P/L: <span style="color: ${profitLoss >= 0 ? '#22c55e' : '#ef4444'}">₹${profitLoss.toFixed(2)}</span>

                            </div>

                            <div class="holding-actions">

                                <button class="holding-btn holding-buy-btn" onclick="openTradingModal('buy', '${symbol}')">Buy More</button>

                                <button class="holding-btn holding-sell-btn" onclick="openTradingModal('sell', '${symbol}')">Sell</button>

                            </div>

                        </div>

                    `;

                }

                tokenList.innerHTML = holdingsHTML;

                return;

            }

            // Show token list based on selected tab

            let tokensToShow = [];

            if (currentTradingTab === 'all') {

                tokensToShow = allTokens;

            } else if (currentTradingTab === 'crypto') {

                tokensToShow = cryptoTokens;

            } else if (currentTradingTab === 'meme') {

                tokensToShow = memeTokens;

            }

            let tokensHTML = '';

            tokensToShow.forEach(([symbol, name, id]) => {

                const price = livePrices[symbol] || 0;

                tokensHTML += `

                    <div class="token-item" data-symbol="${symbol}">

                        <div class="token-info" onclick="showPriceChart('${symbol}')">

                            <div class="token-symbol">${symbol}</div>

                            <div class="token-name">${name}</div>

                        </div>

                        <div class="token-price">₹${price.toLocaleString('en-IN')}</div>

                        <div class="token-actions">

                            <button class="buy-btn" onclick="openTradingModal('buy', '${symbol}')">Buy</button>

                            <button class="sell-btn" onclick="openTradingModal('sell', '${symbol}')">Sell</button>

                        </div>

                    </div>

                `;

            });

            tokenList.innerHTML = tokensHTML;

        }

        // Operation Management

        function toggleOperation(operation) {

            // Close all operations first

            document.querySelectorAll('.operation-content').forEach(content => {

                content.classList.remove('active');

            });

            // Open selected operation

            const content = document.getElementById(operation + 'Content');

            if (content) {

                content.classList.add('active');

                

                if (operation === 'transactions') {

                    loadTransactions();

                }

            }

        }

        function closeOperation() {

            document.querySelectorAll('.operation-content').forEach(content => {

                content.classList.remove('active');

            });

        }

        // Load Transactions

        async function loadTransactions() {

            const transactionsList = document.getElementById('transactionsList');

            transactionsList.innerHTML = '<div style="text-align: center; padding: 20px;">Loading transactions...</div>';

            if (!currentUser) return;

            try {

                const { data, error } = await supabase

                    .from('ak-d&w-status')

                    .select('*')

                    .eq('user_id', currentUser.id)

                    .order('created_at', { ascending: false });

                if (error) throw error;

                if (!data || data.length === 0) {

                    transactionsList.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">No transactions yet</div>';

                    return;

                }

                let transactionsHTML = '';

                data.forEach(transaction => {

                    const date = new Date(transaction.created_at).toLocaleString();

                    transactionsHTML += `

                        <div class="transaction-item">

                            <div class="transaction-header">

                                <span class="transaction-type">

                                    ${transaction.type.charAt(0).toUpperCase() + transaction.type.slice(1)} ${transaction.method}

                                </span>

                                <span class="transaction-status status-${transaction.status}">

                                    ${transaction.status.charAt(0).toUpperCase() + transaction.status.slice(1)}

                                </span>

                            </div>

                            <div class="transaction-details">

                                Order ID: ${transaction.order_id}<br>

                                Amount: ${transaction.token ? transaction.quantity + ' ' + transaction.token : '₹' + parseFloat(transaction.amount).toLocaleString('en-IN')}<br>

                                Date: ${date}

                            </div>

                        </div>

                    `;

                });

                transactionsList.innerHTML = transactionsHTML;

            } catch (error) {

                console.error('Error loading transactions:', error);

                transactionsList.innerHTML = '<div style="text-align: center; padding: 20px; color: #ef4444;">Error loading transactions</div>';

            }

        }

        // Modal Management

        function openModal(modalId) {

            const modal = document.getElementById(modalId);

            modal.classList.add('show');

        }

        function closeModal(modalId) {

            const modal = document.getElementById(modalId);

            modal.classList.remove('show');

        }

        function openProfileModal() {

            openModal('profileModal');

        }

        async function saveProfile() {

            const name = document.getElementById('userName').value.trim();

            const username = document.getElementById('userUsername').value.trim();

            if (!name || !username) {

                showToast('Please fill all fields', false);

                return;

            }

            try {

                const { error } = await supabase

                    .from('ak-profile-user')

                    .update({ name, username })

                    .eq('user_id', currentUser.id);

                if (error) throw error;

                userProfile.name = name;

                userProfile.username = username;

                

                showToast('Profile updated successfully', true);

                closeModal('profileModal');

            } catch (error) {

                console.error('Error saving profile:', error);

                showToast('Error updating profile', false);

            }

        }

        // Deposit Modals

        function openDepositModal(type) {

            const modal = document.getElementById('depositModal');

            const title = document.getElementById('depositModalTitle');

            const content = document.getElementById('depositModalContent');

            title.textContent = `Deposit ${type.toUpperCase()}`;

            if (type === 'upi') {

                content.innerHTML = `

                    <div class="form-group">

                        <label class="form-label">UPI ID: anshumegaming@oksbi</label>

                    </div>

                    <div class="form-group">

                        <label class="form-label">Amount (Minimum ₹100)</label>

                        <input type="number" class="form-input" id="depositAmount" min="100" placeholder="Enter amount">

                    </div>

                    <div class="form-group">

                        <label class="form-label">UTR Number</label>

                        <input type="text" class="form-input" id="depositUTR" placeholder="Enter UTR number">

                    </div>

                    <div class="form-group">

                        <label class="form-label">Payment Screenshot</label>

                        <input type="file" class="form-input" id="depositScreenshot" accept="image/*">

                    </div>

                    <button class="submit-btn" onclick="submitDeposit('upi')">Submit Deposit</button>

                `;

            } else if (type === 'crypto') {

                content.innerHTML = `

                    <div class="form-group">

                        <label class="form-label">Select Token</label>

                        <select class="form-select" id="depositToken">

                            ${allTokens.map(([symbol, name]) => `<option value="${symbol}">${symbol} - ${name}</option>`).join('')}

                        </select>

                    </div>

                    <div class="form-group">

                        <label class="form-label">Deposit Address</label>

                        <input type="text" class="form-input" value="${userWalletAddress}" readonly>

                    </div>

                    <div class="form-group">

                        <label class="form-label">Amount</label>

                        <input type="number" class="form-input" id="depositCryptoAmount" placeholder="Enter amount">

                    </div>

                    <button class="submit-btn" onclick="submitDeposit('crypto')">Submit Deposit</button>

                `;

            } else if (type === 'wallet') {

                content.innerHTML = `

                    <div class="form-group">

                        <label class="form-label">Your Wallet Address</label>

                        <input type="text" class="form-input" value="${userWalletAddress}" readonly>

                    </div>

                    <div class="form-group">

                        <label class="form-label">Select Token</label>

                        <select class="form-select" id="depositWalletToken">

                            ${allTokens.map(([symbol, name]) => `<option value="${symbol}">${symbol} - ${name}</option>`).join('')}

                        </select>

                    </div>

                    <div class="form-group">

                        <label class="form-label">Quantity</label>

                        <input type="number" class="form-input" id="depositWalletQuantity" placeholder="Enter quantity">

                    </div>

                    <button class="submit-btn" onclick="submitDeposit('wallet')">Submit Deposit</button>

                `;

            }

            openModal('depositModal');

        }

        async function submitDeposit(type) {

            try {

                let depositData = {

                    user_id: currentUser.id,

                    type: 'deposit',

                    method: type,

                    order_id: generateOrderID(),

                    status: 'pending',

                    created_at: new Date().toISOString()

                };

                if (type === 'upi') {

                    const amount = parseFloat(document.getElementById('depositAmount').value);

                    const utr = document.getElementById('depositUTR').value.trim();

                    

                    if (!amount || amount < 100 || !utr) {

                        showToast('Please fill all required fields', false);

                        return;

                    }

                    depositData.amount = amount;

                    depositData.utr = utr;

                } else if (type === 'crypto') {

                    const token = document.getElementById('depositToken').value;

                    const amount = parseFloat(document.getElementById('depositCryptoAmount').value);

                    

                    if (!token || !amount || amount < 100) {

                        showToast('Please fill all required fields', false);

                        return;

                    }

                    depositData.token = token;

                    depositData.amount = amount;

                } else if (type === 'wallet') {

                    const token = document.getElementById('depositWalletToken').value;

                    const quantity = parseFloat(document.getElementById('depositWalletQuantity').value);

                    

                    if (!token || !quantity) {

                        showToast('Please fill all required fields', false);

                        return;

                    }

                    const price = livePrices[token] || 0;

                    const amount = quantity * price;

                    

                    if (amount < 100) {

                        showToast('Minimum deposit amount is ₹100', false);

                        return;

                    }

                    depositData.token = token;

                    depositData.quantity = quantity;

                    depositData.amount = amount;

                }

                const { error } = await supabase

                    .from('ak-d&w-status')

                    .insert([depositData]);

                if (error) throw error;

                showToast('Deposit request submitted successfully', true);

                closeModal('depositModal');

                

                setTimeout(() => {

                    toggleOperation('transactions');

                }, 2000);

            } catch (error) {

                console.error('Error submitting deposit:', error);

                showToast('Error submitting deposit', false);

            }

        }

        // Withdrawal Modals

        function openWithdrawalModal(type) {

            const modal = document.getElementById('withdrawalModal');

            const title = document.getElementById('withdrawalModalTitle');

            const content = document.getElementById('withdrawalModalContent');

            title.textContent = `Withdrawal ${type.toUpperCase()}`;

            if (type === 'upi') {

                content.innerHTML = `

                    <div class="form-group">

                        <label class="form-label">Amount (Minimum ₹100)</label>

                        <input type="number" class="form-input" id="withdrawalAmount" min="100" placeholder="Enter amount">

                    </div>

                    <div class="form-group">

                        <label class="form-label">UPI ID</label>

                        <input type="text" class="form-input" id="withdrawalUPI" placeholder="Enter your UPI ID">

                    </div>

                    <button class="submit-btn" onclick="submitWithdrawal('upi')">Submit Withdrawal</button>

                `;

            } else if (type === 'crypto') {

                content.innerHTML = `

                    <div class="form-group">

                        <label class="form-label">Select Token</label>

                        <select class="form-select" id="withdrawalToken">

                            ${allTokens.map(([symbol, name]) => `<option value="${symbol}">${symbol} - ${name}</option>`).join('')}

                        </select>

                    </div>

                    <div class="form-group">

                        <label class="form-label">Withdrawal Address</label>

                        <input type="text" class="form-input" id="withdrawalAddress" placeholder="Enter withdrawal address">

                    </div>

                    <div class="form-group">

                        <label class="form-label">Quantity</label>

                        <input type="number" class="form-input" id="withdrawalQuantity" placeholder="Enter quantity">

                    </div>

                    <button class="submit-btn" onclick="submitWithdrawal('crypto')">Submit Withdrawal</button>

                `;

            } else if (type === 'wallet') {

                content.innerHTML = `

                    <div class="form-group">

                        <label class="form-label">Withdrawal Address</label>

                        <input type="text" class="form-input" id="withdrawalWalletAddress" placeholder="Enter withdrawal address">

                    </div>

                    <div class="form-group">

                        <label class="form-label">Select Token</label>

                        <select class="form-select" id="withdrawalWalletToken">

                            ${allTokens.map(([symbol, name]) => `<option value="${symbol}">${symbol} - ${name}</option>`).join('')}

                        </select>

                    </div>

                    <div class="form-group">

                        <label class="form-label">Quantity</label>

                        <input type="number" class="form-input" id="withdrawalWalletQuantity" placeholder="Enter quantity">

                    </div>

                    <button class="submit-btn" onclick="submitWithdrawal('wallet')">Submit Withdrawal</button>

                `;

            }

            openModal('withdrawalModal');

        }

        async function submitWithdrawal(type) {

            try {

                let withdrawalData = {

                    user_id: currentUser.id,

                    type: 'withdrawal',

                    method: type,

                    order_id: generateOrderID(),

                    status: 'pending',

                    created_at: new Date().toISOString()

                };

                if (type === 'upi') {

                    const amount = parseFloat(document.getElementById('withdrawalAmount').value);

                    const upi = document.getElementById('withdrawalUPI').value.trim();

                    

                    if (!amount || amount < 100 || !upi) {

                        showToast('Please fill all required fields', false);

                        return;

                    }

                    // Check balance

                    const { data: walletData } = await supabase

                        .from('ak-wallet-user')

                        .select('balance')

                        .eq('user_id', currentUser.id)

                        .single();

                    const currentBalance = parseFloat(walletData?.balance || 0);

                    if (amount > currentBalance) {

                        showToast('Insufficient balance', false);

                        return;

                    }

                    withdrawalData.amount = amount;

                    withdrawalData.upi_id = upi;

                } else if (type === 'crypto') {

                    const token = document.getElementById('withdrawalToken').value;

                    const address = document.getElementById('withdrawalAddress').value.trim();

                    const quantity = parseFloat(document.getElementById('withdrawalQuantity').value);

                    

                    if (!token || !address || !quantity) {

                        showToast('Please fill all required fields', false);

                        return;

                    }

                    // Check if user has enough tokens

                    const holding = userHoldings[token];

                    if (!holding || holding.quantity < quantity) {

                        showToast(`Insufficient ${token} balance`, false);

                        return;

                    }

                    const price = livePrices[token] || 0;

                    const amount = quantity * price;

                    

                    if (amount < 100) {

                        showToast('Minimum withdrawal amount is ₹100', false);

                        return;

                    }

                    withdrawalData.token = token;

                    withdrawalData.quantity = quantity;

                    withdrawalData.amount = amount;

                    withdrawalData.address = address;

                } else if (type === 'wallet') {

                    const address = document.getElementById('withdrawalWalletAddress').value.trim();

                    const token = document.getElementById('withdrawalWalletToken').value;

                    const quantity = parseFloat(document.getElementById('withdrawalWalletQuantity').value);

                    

                    if (!address || !token || !quantity) {

                        showToast('Please fill all required fields', false);

                        return;

                    }

                    // Check if user has enough tokens

                    const holding = userHoldings[token];

                    if (!holding || holding.quantity < quantity) {

                        showToast(`Insufficient ${token} balance`, false);

                        return;

                    }

                    const price = livePrices[token] || 0;

                    const amount = quantity * price;

                    

                    if (amount < 100) {

                        showToast('Minimum withdrawal amount is ₹100', false);

                        return;

                    }

                    withdrawalData.token = token;

                    withdrawalData.quantity = quantity;

                    withdrawalData.amount = amount;

                    withdrawalData.address = address;

                }

                const { error } = await supabase

                    .from('ak-d&w-status')

                    .insert([withdrawalData]);

                if (error) throw error;

                showToast('Withdrawal request submitted successfully', true);

                closeModal('withdrawalModal');

                

                setTimeout(() => {

                    toggleOperation('transactions');

                }, 2000);

            } catch (error) {

                console.error('Error submitting withdrawal:', error);

                showToast('Error submitting withdrawal', false);

            }

        }

        // Trading Modals

        function openTradingModal(action, symbol) {

            const modal = document.getElementById('tradingModal');

            const title = document.getElementById('tradingModalTitle');

            const content = document.getElementById('tradingModalContent');

            title.textContent = `${action.charAt(0).toUpperCase() + action.slice(1)} ${symbol}`;

            const currentPrice = livePrices[symbol] || 0;

            const holding = userHoldings[symbol] || { quantity: 0 };

            content.innerHTML = `

                <div class="form-group">

                    <label class="form-label">Current Price: ₹${currentPrice.toLocaleString('en-IN')}</label>

                    <label class="form-label">Your Holdings: ${holding.quantity.toFixed(6)} ${symbol}</label>

                </div>

                <div class="form-group">

                    <label class="form-label">Amount (INR)</label>

                    <input type="number" class="form-input" id="tradeAmount" placeholder="Enter amount" ${action === 'buy' ? 'min="100"' : ''}>

                </div>

                <div class="form-group">

                    <label class="form-label">Quantity</label>

                    <input type="number" class="form-input" id="tradeQuantity" placeholder="Enter quantity" step="0.000001">

                </div>

                <button class="submit-btn" onclick="submitTrade('${action}', '${symbol}')">${action.charAt(0).toUpperCase() + action.slice(1)} ${symbol}</button>

            `;

            // Add real-time calculation

            const amountInput = content.querySelector('#tradeAmount');

            const quantityInput = content.querySelector('#tradeQuantity');

            amountInput.addEventListener('input', () => {

                if (currentPrice > 0 && amountInput.value) {

                    quantityInput.value = (parseFloat(amountInput.value) / currentPrice).toFixed(8);

                }

            });

            quantityInput.addEventListener('input', () => {

                if (currentPrice > 0 && quantityInput.value) {

                    amountInput.value = (parseFloat(quantityInput.value) * currentPrice).toFixed(2);

                }

            });

            openModal('tradingModal');

        }

        async function submitTrade(action, symbol) {

            try {

                const amount = parseFloat(document.getElementById('tradeAmount').value);

                const quantity = parseFloat(document.getElementById('tradeQuantity').value);

                const currentPrice = livePrices[symbol] || 0;

                if (!amount || !quantity || currentPrice <= 0) {

                    showToast('Please enter valid amount and quantity', false);

                    return;

                }

                if (amount < 100) {

                    showToast('Minimum trade amount is ₹100', false);

                    return;

                }

                if (action === 'buy') {

                    // Check wallet balance

                    const { data: walletData } = await supabase

                        .from('ak-wallet-user')

                        .select('balance')

                        .eq('user_id', currentUser.id)

                        .single();

                    const currentBalance = parseFloat(walletData?.balance || 0);

                    if (amount > currentBalance) {

                        showToast('Insufficient balance', false);

                        return;

                    }

                    // Deduct from wallet

                    await supabase

                        .from('ak-wallet-user')

                        .update({ balance: currentBalance - amount })

                        .eq('user_id', currentUser.id);

                } else if (action === 'sell') {

                    // Check token holdings

                    const holding = userHoldings[symbol];

                    if (!holding || holding.quantity < quantity) {

                        showToast(`Insufficient ${symbol} balance`, false);

                        return;

                    }

                    // Add to wallet

                    const { data: walletData } = await supabase

                        .from('ak-wallet-user')

                        .select('balance')

                        .eq('user_id', currentUser.id)

                        .single();

                    const currentBalance = parseFloat(walletData?.balance || 0);

                    await supabase

                        .from('ak-wallet-user')

                        .update({ balance: currentBalance + amount })

                        .eq('user_id', currentUser.id);

                }

                // Save trade to history

                const tradeData = {

                    user_id: currentUser.id,

                    action: action,

                    symbol: symbol,

                    quantity: quantity,

                    price: currentPrice,

                    amount: amount,

                    created_at: new Date().toISOString()

                };

                const { error } = await supabase

                    .from('ak-trade-history')

                    .insert([tradeData]);

                if (error) throw error;

                showToast(`${symbol} ${action} successful!`, true);

                closeModal('tradingModal');

                // Refresh data

                await loadBalance();

                await loadHoldings();

                if (currentTradingTab === 'holding') {

                    loadTokenList();

                }

            } catch (error) {

                console.error('Error executing trade:', error);

                showToast('Error executing trade', false);

            }

        }

        // Price Chart

        function showPriceChart(symbol) {

            const modal = document.getElementById('chartModal');

            const title = document.getElementById('chartModalTitle');

            

            title.textContent = `${symbol} Price Chart`;

            

            openModal('chartModal');

            

            // Simple chart simulation (in real app, you'd use Chart.js or similar)

            const canvas = document.getElementById('priceChart');

            const ctx = canvas.getContext('2d');

            

            // Clear canvas

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            

            // Draw simple price line

            ctx.strokeStyle = '#667eea';

            ctx.lineWidth = 2;

            ctx.beginPath();

            

            const currentPrice = livePrices[symbol] || 0;

            const points = [];

            

            // Generate mock historical data

            for (let i = 0; i < 30; i++) {

                const variation = (Math.random() - 0.5) * 0.2;

                const price = currentPrice * (1 + variation);

                points.push(price);

            }

            

            // Draw line

            for (let i = 0; i < points.length; i++) {

                const x = (i / (points.length - 1)) * canvas.width;

                const y = canvas.height - ((points[i] / Math.max(...points)) * canvas.height * 0.8) - 20;

                

                if (i === 0) {

                    ctx.moveTo(x, y);

                } else {

                    ctx.lineTo(x, y);

                }

            }

            

            ctx.stroke();

        }

        // Utility Functions

        function copyWalletAddress() {

            navigator.clipboard.writeText(userWalletAddress).then(() => {

                showToast('Wallet address copied!', true);

            }).catch(() => {

                showToast('Failed to copy address', false);

            });

        }

        function showToast(message, isSuccess = true) {

            const toast = document.getElementById('toast');

            toast.textContent = message;

            toast.className = `toast ${isSuccess ? 'success' : 'error'}`;

            toast.classList.add('show');

            setTimeout(() => {

                toast.classList.remove('show');

            }, 3000);

        }

        // Close modal when clicking outside

        window.onclick = function(event) {

            const modals = document.querySelectorAll('.modal');

            modals.forEach(modal => {

                if (event.target === modal) {

                    modal.classList.remove('show');

                }

            });

        }

        // Initialize app when page loads

        document.addEventListener('DOMContentLoaded', initApp);

    </script>

</body>

</html>